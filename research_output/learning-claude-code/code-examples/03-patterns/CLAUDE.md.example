# CLAUDE.md Example

This is a template for a production-ready CLAUDE.md file.

---

# Project: E-Commerce Platform

Modern e-commerce platform built with Next.js 14, TypeScript, Prisma, and Tailwind CSS.

## Stack

- **Framework**: Next.js 14 (App Router)
- **Language**: TypeScript (strict mode)
- **Database**: PostgreSQL via Prisma ORM
- **Styling**: Tailwind CSS + shadcn/ui components
- **Auth**: NextAuth.js v5
- **Payments**: Stripe
- **Email**: Resend
- **Testing**: Vitest + React Testing Library + Playwright

## Code Style

### TypeScript
- Use strict mode (`strict: true` in tsconfig.json)
- Prefer `type` over `interface` for object shapes
- Use Zod for runtime validation
- No `any` types - use `unknown` if type is truly unknown

### React
- Prefer Server Components by default
- Use "use client" directive only when needed (interactivity, hooks, browser APIs)
- Keep components small (<150 lines)
- Extract logic into custom hooks or utilities

### File Structure
```
app/                    # Next.js app router pages
  ├── (auth)/          # Auth pages (grouped route)
  ├── (shop)/          # Shop pages (grouped route)
  └── api/             # API routes
components/            # React components
  ├── ui/              # shadcn/ui components (auto-generated)
  └── [feature]/       # Feature-specific components
lib/                   # Utilities and shared logic
  ├── db/              # Database queries and schemas
  ├── auth/            # Authentication helpers
  └── utils/           # General utilities
prisma/                # Database schema and migrations
tests/                 # Test files
  ├── unit/
  ├── integration/
  └── e2e/
```

### Naming Conventions
- Components: PascalCase (`UserProfile.tsx`)
- Utilities: camelCase (`formatCurrency.ts`)
- Constants: UPPER_SNAKE_CASE (`MAX_CART_ITEMS`)
- Database models: PascalCase singular (`User`, `Product`)
- API routes: lowercase with hyphens (`/api/user-profile`)

## Commands

### Development
```bash
npm run dev          # Start dev server (localhost:3000)
npm run build        # Build for production
npm run start        # Start production server
```

### Database
```bash
npx prisma studio    # Open Prisma Studio (database GUI)
npx prisma migrate dev --name <name>   # Create and apply migration
npx prisma generate  # Regenerate Prisma Client
npm run db:seed      # Seed database with test data
npm run db:reset     # Reset database (dev only!)
```

### Testing
```bash
npm test                     # Run all unit/integration tests
npm test -- path/to/file     # Run specific test file
npm run test:e2e             # Run Playwright E2E tests
npm run test:coverage        # Generate coverage report
```

### Linting & Formatting
```bash
npm run lint         # Run ESLint
npm run lint:fix     # Fix auto-fixable issues
npm run format       # Format with Prettier
npm run typecheck    # Run TypeScript compiler check
```

## Development Workflow

### Before Committing
1. Run typecheck: `npm run typecheck`
2. Run tests: `npm test`
3. Run lint: `npm run lint`
4. All three must pass before committing

### Adding a New Feature
1. Create feature branch: `git checkout -b feature/name`
2. Implement with tests
3. Run full test suite
4. Create PR with description and test plan
5. Ensure CI passes before merging

### Database Changes
1. Update `prisma/schema.prisma`
2. Create migration: `npx prisma migrate dev --name descriptive-name`
3. Verify in Prisma Studio
4. Update seed data if needed
5. Test locally before committing

## Architecture Patterns

### API Routes
- Use Next.js Route Handlers (app/api/)
- Return standardized responses:
  ```typescript
  // Success
  return NextResponse.json({ data: result }, { status: 200 })

  // Error
  return NextResponse.json({ error: "Message" }, { status: 400 })
  ```
- Validate input with Zod schemas
- Handle errors with try/catch
- Use middleware for auth checks

### Database Queries
- All queries go in `lib/db/[model].ts`
- Export functions, don't export raw Prisma client
- Example:
  ```typescript
  // lib/db/users.ts
  export async function getUserById(id: string) {
    return prisma.user.findUnique({ where: { id } })
  }
  ```

### Error Handling
- Use custom error classes (in `lib/errors.ts`)
- Log errors with structured logging
- Return user-friendly messages to clients
- Never expose stack traces to users in production

### Authentication
- All API routes requiring auth should check `await auth()` from NextAuth
- Protected pages use middleware (see `middleware.ts`)
- Store minimal data in JWT (just id, email, role)

## Testing Guidelines

### Unit Tests
- Test utilities and business logic
- Use Vitest
- Aim for 80%+ coverage on critical paths
- Mock external dependencies

### Integration Tests
- Test API routes
- Use test database (configured in `.env.test`)
- Clean up after tests

### E2E Tests
- Test critical user flows (signup, checkout, etc.)
- Use Playwright
- Run against local dev server
- Keep under 20 tests (they're slow)

## Environment Variables

Required variables (see `.env.example`):

- `DATABASE_URL`: PostgreSQL connection string
- `NEXTAUTH_SECRET`: Secret for NextAuth
- `NEXTAUTH_URL`: App URL
- `STRIPE_SECRET_KEY`: Stripe API key
- `RESEND_API_KEY`: Resend email API key
- `NEXT_PUBLIC_APP_URL`: Public app URL

**Never commit `.env` files!**

## Common Gotchas

1. **Prisma Client**: Regenerate after schema changes (`npx prisma generate`)
2. **Cache**: Clear Next.js cache if builds act weird (rm -rf .next)
3. **Server Components**: Can't use hooks or browser APIs
4. **Environment Variables**: Must restart dev server after changes
5. **Prisma in Development**: Use `prisma migrate dev`, not `migrate deploy`

## Helpful Resources

- [Next.js Docs](https://nextjs.org/docs)
- [Prisma Docs](https://www.prisma.io/docs)
- [shadcn/ui](https://ui.shadcn.com/)
- [NextAuth.js v5](https://authjs.dev/)

---

**Last Updated**: 2024-02-20
**Team**: Keep this file under 200 lines. Remove outdated information.
